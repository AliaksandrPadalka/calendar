<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.1"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.1
                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.1.xsd">

    <changeSet  id="1" author="aliaksandr_padalka@epam.com">

        <createTable tableName="operations">
            <column name="operationid" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="duration" type="FLOAT8"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="recordid" type="BIGINT"/>
        </createTable>

        <createTable tableName="phones">
            <column name="phoneid" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(255)"/>
            <column name="number" type="VARCHAR(255)"/>
            <column name="type" type="VARCHAR(255)"/>
            <column name="userid" type="BIGINT"/>
        </createTable>

        <createTable tableName="records">
            <column name="recordid" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="userid" type="BIGINT"/>
        </createTable>

        <createTable tableName="users">
            <column name="userid" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="userrole" type="VARCHAR(255)"/>
        </createTable>

        <addPrimaryKey columnNames="operationid" constraintName="operations_pkey" tableName="operations"/>
        <addPrimaryKey columnNames="phoneid" constraintName="phones_pkey" tableName="phones"/>
        <addPrimaryKey columnNames="recordid" constraintName="records_pkey" tableName="records"/>
        <addPrimaryKey columnNames="userid" constraintName="users_pkey" tableName="users"/>

        <addForeignKeyConstraint baseColumnNames="recordid" baseTableName="operations"
                                 constraintName="fk_5r29vaokhxc7sh035aa6et463" deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="recordid" referencedTableName="records"/>
        <addForeignKeyConstraint baseColumnNames="userid" baseTableName="records"
                                 constraintName="fk_b7an0av17e8hwrgbhxukc3y51" deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="userid" referencedTableName="users"/>
        <addForeignKeyConstraint baseColumnNames="userid" baseTableName="phones"
                                 constraintName="fk_t2oxnyjl9oh3n0y3wqh171kts" deferrable="false"
                                 initiallyDeferred="false" referencedColumnNames="userid" referencedTableName="users"/>

        <createSequence incrementBy="1" maxValue="9223372036854775807" minValue="1"
                        sequenceName="entity_id_seq" startValue="1"/>

    </changeSet>

</databaseChangeLog>